destfile <- "cb_2020_us_county_20m.zip"
if(!file.exists(destfile)){download.file(url = url, destfile = destfile)}
#read in file
library(sf)
#all counties
counties <-
sf::st_read(
dsn = "cb_2020_us_county_20m",
layer = "cb_2020_us_county_20m"
) |>
# convert coordinates to simple feature
sf::st_transform('+proj=longlat +datum=WGS84') |>
# reduce file size
sf::st_simplify() |>
# convert variables to lowercase
dplyr::rename_all(~janitor::make_clean_names(.x))
#california fips is "06"
ca <-
counties |>
dplyr::filter(grepl("06", statefp))
plot(ca |> dplyr::select(countyfp))
ca_counties <-
ca |>
dplyr::filter(name %in% c("Los Angeles", "San Francisco", "Napa"))
library(leaflet)
leaflet() |>
#setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
addTiles() |>
addPolygons(data = ca_counties,
popup = ~name)
counties_join_by_group <-
ca |>
dplyr::mutate(number = 1) |>
dplyr::group_by(statefp) |>
dplyr::summarize(tot = sum(number))
#map
leaflet() |>
#fitBounds(-124.4, 32.5, -114.1,  42) |>
setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
addTiles() |>
addPolygons(data = counties_join_by_group)
# join counties into California
counties_join_by_union <- sf::st_union(ca)
# map
leaflet() %>%
fitBounds(-124.4, 32.5, -114.1,  42) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(
data = counties_join_by_union
)
centroids <- sf::st_centroid(ca)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
#layer groups
addPolygons(data = sf::st_union(ca),
group = "State") |>
addPolygons(data = ca,
group = "Counties") |>
addMarkers(lat = unlist(lapply(centroids$geometry, "[[", 2)),
lng = unlist(lapply(centroids$geometry, "[[", 1)),
group = "Centroids"
) |>
#layer control
addLayersControl(
overlayGroups = c("State", "Counties", "Centroids"),
position = "topright",
options = layersControlOptions(collapsed = FALSE)
) |>
# hide
hideGroup(c("State", "Counties", "Centroids"))
file <- 'https://www.ers.usda.gov/webdocs/DataFiles/48747/Unemployment.xlsx'
usda <- rio::import(
file = file,
skip = 4
) |>
dplyr::rename_all(~janitor::make_clean_names(.x)) |>
dplyr::select(fips_code:area_name, unemployment_rate_2020) |>
dplyr::filter(state == "CA") |>
tidyr::separate(fips_code, into = c("statefp", "countyfp"), sep = 2) |>
dplyr::select(statefp, countyfp, unemployment_rate_2020)
ca_choropleth <-
dplyr::left_join(ca, usda, by = c("statefp", "countyfp"))
pal <- colorNumeric(palette = RColorBrewer::brewer.pal(5, "Dark2"),
domain = ca_choropleth$unemployment_rate_2020
)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(data = ca_choropleth,
color = ~pal(unemployment_rate_2020),
popup = ~unemployment_rate_2020)
# system & package info
options(width = 120)
session_info()
## Load frequently used packages for blog posts
packages <- c(
'devtools', #for session info
'blogdown',
'sf',
'leaflet'
)
lapply(packages, function(x) {
if (!requireNamespace(x)) install.packages(x)
library(x, character.only = TRUE)
})
## Do not break chunk line
## Do not use spaces or periods "." or underscores "_"
## set options for knitr
knitr::opts_chunk$set(
comment = '',
fig.width = 6,
fig.asp = .8,
fig.align="center",
message=F,
error=F,
warning=F,
tidy=F,
comment='',
cache=F,
dev='svg',
echo=F
)
# write packages used to bib in current directory
knitr::write_bib(.packages(), "./packages.bib")
#download file to local drive
url <- "https://www2.census.gov/geo/tiger/GENZ2020/shp/cb_2020_us_county_20m.zip"
destfile <- "cb_2020_us_county_20m.zip"
if(!file.exists(destfile)){download.file(url = url, destfile = destfile)}
#read in file
library(sf)
#all counties
counties <-
sf::st_read(
dsn = "cb_2020_us_county_20m",
layer = "cb_2020_us_county_20m"
) |>
# convert coordinates to simple feature
sf::st_transform('+proj=longlat +datum=WGS84') |>
# reduce file size
sf::st_simplify() |>
# convert variables to lowercase
dplyr::rename_all(~janitor::make_clean_names(.x))
#california fips is "06"
ca <-
counties |>
dplyr::filter(grepl("06", statefp))
plot(ca |> dplyr::select(countyfp))
ca_counties <-
ca |>
dplyr::filter(name %in% c("Los Angeles", "San Francisco", "Napa"))
library(leaflet)
leaflet() |>
#setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
addTiles() |>
addPolygons(data = ca_counties,
popup = ~name)
counties_join_by_group <-
ca |>
dplyr::mutate(number = 1) |>
dplyr::group_by(statefp) |>
dplyr::summarize(tot = sum(number))
#map
leaflet() |>
#fitBounds(-124.4, 32.5, -114.1,  42) |>
setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
addTiles() |>
addPolygons(data = counties_join_by_group)
# join counties into California
counties_join_by_union <- sf::st_union(ca)
# map
leaflet() %>%
fitBounds(-124.4, 32.5, -114.1,  42) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(
data = counties_join_by_union
)
centroids <- sf::st_centroid(ca)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
#layer groups
addPolygons(data = sf::st_union(ca),
group = "State") |>
addPolygons(data = ca,
group = "Counties") |>
addMarkers(lat = unlist(lapply(centroids$geometry, "[[", 2)),
lng = unlist(lapply(centroids$geometry, "[[", 1)),
group = "Centroids"
) |>
#layer control
addLayersControl(
overlayGroups = c("State", "Counties", "Centroids"),
position = "topright",
options = layersControlOptions(collapsed = FALSE)
) |>
# hide
hideGroup(c("State", "Counties", "Centroids"))
file <- 'https://www.ers.usda.gov/webdocs/DataFiles/48747/Unemployment.xlsx'
usda <- rio::import(
file = file,
skip = 4
) |>
dplyr::rename_all(~janitor::make_clean_names(.x)) |>
dplyr::select(fips_code:area_name, unemployment_rate_2020) |>
dplyr::filter(state == "CA") |>
tidyr::separate(fips_code, into = c("statefp", "countyfp"), sep = 2) |>
dplyr::select(statefp, countyfp, unemployment_rate_2020)
ca_choropleth <-
dplyr::left_join(ca, usda, by = c("statefp", "countyfp"))
pal <- colorNumeric(palette = RColorBrewer::brewer.pal(5, "Dark2"),
domain = ca_choropleth$unemployment_rate_2020
)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(data = ca_choropleth,
color = ~pal(unemployment_rate_2020),
popup = ~unemployment_rate_2020)
# system & package info
options(width = 120)
session_info()
?blogdown::serve_site
blogdown::serve_site()
stop_server()
blogdown::serve_site()
## Load frequently used packages for blog posts
packages <- c(
'devtools', #for session info
'blogdown',
'sf',
'leaflet'
)
lapply(packages, function(x) {
if (!requireNamespace(x)) install.packages(x)
library(x, character.only = TRUE)
})
## Do not break chunk line
## Do not use spaces or periods "." or underscores "_"
## set options for knitr
knitr::opts_chunk$set(
comment = '',
fig.width = 6,
fig.asp = .8,
fig.align="center",
message=F,
error=F,
warning=F,
tidy=F,
comment='',
cache=F,
dev='svg',
echo=F
)
# write packages used to bib in current directory
knitr::write_bib(.packages(), "./packages.bib")
#download file to local drive
url <- "https://www2.census.gov/geo/tiger/GENZ2020/shp/cb_2020_us_county_20m.zip"
destfile <- "cb_2020_us_county_20m.zip"
if(!file.exists(destfile)){download.file(url = url, destfile = destfile)}
#read in file
library(sf)
#all counties
counties <-
sf::st_read(
dsn = "cb_2020_us_county_20m",
layer = "cb_2020_us_county_20m"
) |>
# convert coordinates to simple feature
sf::st_transform('+proj=longlat +datum=WGS84') |>
# reduce file size
sf::st_simplify() |>
# convert variables to lowercase
dplyr::rename_all(~janitor::make_clean_names(.x))
#california fips is "06"
ca <-
counties |>
dplyr::filter(grepl("06", statefp))
plot(ca |> dplyr::select(countyfp))
ca_counties <-
ca |>
dplyr::filter(name %in% c("Los Angeles", "San Francisco", "Napa"))
library(leaflet)
leaflet() |>
#setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
addTiles() |>
addPolygons(data = ca_counties,
popup = ~name)
counties_join_by_group <-
ca |>
dplyr::mutate(number = 1) |>
dplyr::group_by(statefp) |>
dplyr::summarize(tot = sum(number))
#map
leaflet() |>
#fitBounds(-124.4, 32.5, -114.1,  42) |>
setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
addTiles() |>
addPolygons(data = counties_join_by_group)
# join counties into California
counties_join_by_union <- sf::st_union(ca)
# map
leaflet() %>%
fitBounds(-124.4, 32.5, -114.1,  42) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(
data = counties_join_by_union
)
centroids <- sf::st_centroid(ca)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
#layer groups
addPolygons(data = sf::st_union(ca),
group = "State") |>
addPolygons(data = ca,
group = "Counties") |>
addMarkers(lat = unlist(lapply(centroids$geometry, "[[", 2)),
lng = unlist(lapply(centroids$geometry, "[[", 1)),
group = "Centroids"
) |>
#layer control
addLayersControl(
overlayGroups = c("State", "Counties", "Centroids"),
position = "topright",
options = layersControlOptions(collapsed = FALSE)
) |>
# hide
hideGroup(c("State", "Counties", "Centroids"))
file <- 'https://www.ers.usda.gov/webdocs/DataFiles/48747/Unemployment.xlsx'
usda <- rio::import(
file = file,
skip = 4
) |>
dplyr::rename_all(~janitor::make_clean_names(.x)) |>
dplyr::select(fips_code:area_name, unemployment_rate_2020) |>
dplyr::filter(state == "CA") |>
tidyr::separate(fips_code, into = c("statefp", "countyfp"), sep = 2) |>
dplyr::select(statefp, countyfp, unemployment_rate_2020)
ca_choropleth <-
dplyr::left_join(ca, usda, by = c("statefp", "countyfp"))
pal <- colorNumeric(palette = RColorBrewer::brewer.pal(5, "Dark2"),
domain = ca_choropleth$unemployment_rate_2020
)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(data = ca_choropleth,
color = ~pal(unemployment_rate_2020),
popup = ~unemployment_rate_2020)
# system & package info
options(width = 120)
session_info()
blogdown::serve_site()
blogdown::serve_site()
stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
library(blogdown)
remove.packages("blogdown")
install.packages("blogdown")
blogdown::serve_site()
## Load frequently used packages for blog posts
packages <- c(
'devtools', #for session info
'blogdown',
'sf',
'leaflet'
)
lapply(packages, function(x) {
if (!requireNamespace(x)) install.packages(x)
library(x, character.only = TRUE)
})
## Do not break chunk line
## Do not use spaces or periods "." or underscores "_"
## set options for knitr
knitr::opts_chunk$set(
comment = '',
fig.width = 6,
fig.asp = .8,
fig.align="center",
message=F,
error=F,
warning=F,
tidy=F,
comment='',
cache=F,
dev='svg',
echo=F
)
# write packages used to bib in current directory
knitr::write_bib(.packages(), "./packages.bib")
#download file to local drive
url <- "https://www2.census.gov/geo/tiger/GENZ2020/shp/cb_2020_us_county_20m.zip"
destfile <- "cb_2020_us_county_20m.zip"
if(!file.exists(destfile)){download.file(url = url, destfile = destfile)}
#read in file
library(sf)
#all counties
counties <-
sf::st_read(
dsn = "cb_2020_us_county_20m",
layer = "cb_2020_us_county_20m"
) |>
# convert coordinates to simple feature
sf::st_transform('+proj=longlat +datum=WGS84') |>
# reduce file size
sf::st_simplify() |>
# convert variables to lowercase
dplyr::rename_all(~janitor::make_clean_names(.x))
#california fips is "06"
ca <-
counties |>
dplyr::filter(grepl("06", statefp))
plot(ca |> dplyr::select(countyfp))
ca_counties <-
ca |>
dplyr::filter(name %in% c("Los Angeles", "San Francisco", "Napa"))
library(leaflet)
leaflet() |>
#setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
addTiles() |>
addPolygons(data = ca_counties,
popup = ~name)
counties_join_by_group <-
ca |>
dplyr::mutate(number = 1) |>
dplyr::group_by(statefp) |>
dplyr::summarize(tot = sum(number))
#map
leaflet() |>
#fitBounds(-124.4, 32.5, -114.1,  42) |>
setView(-120.52462403790528, 37.74238197955183, zoom = 5) |>
addTiles() |>
addPolygons(data = counties_join_by_group)
# join counties into California
counties_join_by_union <- sf::st_union(ca)
# map
leaflet() %>%
fitBounds(-124.4, 32.5, -114.1,  42) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(
data = counties_join_by_union
)
centroids <- sf::st_centroid(ca)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
#layer groups
addPolygons(data = sf::st_union(ca),
group = "State") |>
addPolygons(data = ca,
group = "Counties") |>
addMarkers(lat = unlist(lapply(centroids$geometry, "[[", 2)),
lng = unlist(lapply(centroids$geometry, "[[", 1)),
group = "Centroids"
) |>
#layer control
addLayersControl(
overlayGroups = c("State", "Counties", "Centroids"),
position = "topright",
options = layersControlOptions(collapsed = FALSE)
) |>
# hide
hideGroup(c("State", "Counties", "Centroids"))
file <- 'https://www.ers.usda.gov/webdocs/DataFiles/48747/Unemployment.xlsx'
usda <- rio::import(
file = file,
skip = 4
) |>
dplyr::rename_all(~janitor::make_clean_names(.x)) |>
dplyr::select(fips_code:area_name, unemployment_rate_2020) |>
dplyr::filter(state == "CA") |>
tidyr::separate(fips_code, into = c("statefp", "countyfp"), sep = 2) |>
dplyr::select(statefp, countyfp, unemployment_rate_2020)
ca_choropleth <-
dplyr::left_join(ca, usda, by = c("statefp", "countyfp"))
pal <- colorNumeric(palette = RColorBrewer::brewer.pal(5, "Dark2"),
domain = ca_choropleth$unemployment_rate_2020
)
leaflet() |>
fitBounds(-122.6, 32.8, -117.6, 38.8) |>
#base groups
addTiles(group = "OSM (default)") |>
addPolygons(data = ca_choropleth,
color = ~pal(unemployment_rate_2020),
popup = ~unemployment_rate_2020)
# system & package info
options(width = 120)
session_info()
serve_site()
