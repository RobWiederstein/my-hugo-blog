guides(colour = guide_legend(title = "Forecast"))
fit_naive <- train |> model(NAIVE(incidents_per_month))
fit_mean <- train |> model(MEAN(incidents_per_month))#Comparing ARIMA() and ETS() on seasonal data
fit_s_naive <- train |> model(SNAIVE(incidents_per_month))
fit_ets = train |> model(ETS(incidents_per_month))
fit_arima <- train |> model(ARIMA(incidents_per_month))
# results
bind_rows(
fit_naive |> accuracy(),
fit_mean |> accuracy(),
fit_s_naive |> accuracy(),
fit_ets |>  accuracy(),
fit_arima |> accuracy(),
fit_naive |> forecast(h = 6) |> accuracy(lasers_mon),
fit_mean |> forecast(h = 6) |> accuracy(lasers_mon),
fit_s_naive |> forecast(h = 6) |> accuracy(lasers_mon),
fit_ets |> forecast(h = 6) |> accuracy(lasers_mon),
fit_arima |> forecast(h = 6) |> accuracy(lasers_mon)
) |>
select(-ME, -MPE, -ACF1) |>
arrange(.type, MAE)
laser_fc <-
lasers_mon |>
model(ETS(incidents_per_month)) |>
forecast(h = 12)
laser_fc |>
autoplot(filter_index(lasers_mon, "2017-01" ~ .))+
ggthemes::theme_fivethirtyeight() +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "Data from Federal Aviation Admin.")
laser_fc |>
autoplot(filter_index(lasers_mon, "2017-01" ~ .))+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "Data from Federal Aviation Admin.")
laser_fc |>
autoplot(filter_index(lasers_mon, "2017-01" ~ .))+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
?autoplot.forecast
## Load frequently used packages for blog posts
packages <- c(
'colorspace',
'devtools', #for session info
'dplyr',
'ggthemes', #for plots
'ggplot2',
'blogdown',
'lubridate',
'lasers',
'scales',
'fable',
'forecast',
'tsibble'
)
#devtools::install_github("robwiederstein/lasers")
lapply(packages, function(x) {
if (!requireNamespace(x)) install.packages(x)
library(x, character.only = TRUE)
})
## Do not break chunk line
## Do not use spaces or periods "." or underscores "_"
## set options for knitr
knitr::opts_chunk$set(
comment = '',
fig.width = 6,
fig.height = 4,
fig.align="center",
message=F,
error=F,
warning=F,
tidy=T,
comment='',
cache=T,
dev='svg',
echo=F
)
#from ggthemes
library(ggplot2); theme_set(ggthemes::theme_fivethirtyeight())
# color blind friendly palette from http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#000000")
# write packages used to bib in current directory
knitr::write_bib(.packages(), "./packages.bib")
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarize(n = n()) |>
ggplot() +
aes(month, n) +
geom_line() +
scale_x_datetime(name = "") +
scale_y_continuous(name = "",
labels = label_comma(),
limits = c(0, 1050)) +
labs(title = "Monthly Total U.S. Aircraft Laser Reports",
subtitle = "2010 - 2021",
caption = "Federal Aviation Admin.") +
ggthemes::theme_fivethirtyeight() +
geom_smooth(method = 'loess',
formula = 'y ~ x',
color = cbPalette[2])
lasers |>
mutate(year = floor_date(date_time, "year")) |>
filter(injury == "yes") |>
group_by(year) |>
summarize(injury = n()) |>
ggplot() +
aes(year, injury) +
geom_line(color = cbPalette[2],
size = .9) +
geom_point(color = cbPalette[2],
size = 2) +
scale_y_continuous(limits = c(0, 60),
breaks = c(0, 20, 40, 60)) +
labs(title = "Total Annual U.S. Aircraft Laser Injuries",
subtitle = "2015 - 2021",
caption = "Federal Aviation Admin.") +
ggthemes::theme_fivethirtyeight()
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarize(average_alt = mean(altitude, trim = .05)) |>
ggplot() +
aes(month, average_alt) +
geom_line() +
scale_x_datetime(name = "") +
scale_y_continuous(name = "",
labels = label_comma(),
limits = c(0, 9000)) +
labs(title = "Monthly Laser Reports by Altitude",
subtitle = "2010 - 2021",
caption = "Federal Aviation Admin.") +
ggthemes::theme_fivethirtyeight() +
geom_smooth(method = 'loess',
formula = 'y ~ x',
color = cbPalette[2]) +
ggthemes::theme_fivethirtyeight()
lasers |>
mutate(aircraft_type =
as.character(aircraft)) |>
mutate(aircraft_type =
case_when(
aircraft_type == "HELO" ~ "helicopter",
aircraft_type != "HELO" ~ "fixed_wing"
)
) |>
mutate(aircraft_type = factor(aircraft_type)) |>
ggplot() +
aes(aircraft_type, altitude, group = aircraft_type, color = aircraft_type, fill = aircraft_type) +
geom_violin(outlier.shape = NA, alpha = .65, size = 1) +
coord_cartesian(ylim = quantile(lasers$altitude, c(0.05, 0.95))) +
scale_y_continuous(limits = c(0, 20000),
labels = scales::label_comma()) +
labs(
title = "Altitude by Aircraft Type",
subtitle = "",
caption = "Federal Aviation Admin."
) +
scale_color_manual(values = cbPalette[1:2]) +
scale_fill_manual(values = cbPalette[1:2]) +
ggthemes::theme_fivethirtyeight() +
theme(legend.position = "none")
lasers |>
mutate(month = floor_date(date_time, "month")) |>
mutate(injury = factor(injury)) |>
group_by(month, injury) |>
summarize(n = n()) |>
ggplot() +
aes(month, n, group = injury, color = injury) +
geom_line() +
scale_color_manual(values = cbPalette) +
scale_x_datetime(name = "") +
scale_y_continuous(name = "",
labels = label_comma()) +
labs(title = "U.S. Aircraft Laser Injuries by Month",
subtitle = "2010 - 2021",
caption = "Federal Aviation Admin.") +
ggthemes::theme_fivethirtyeight()
lasers |>
filter(injury == "yes") |>
mutate(laser_color = factor(laser_color,
levels = c("green", "blue", "white", "multi", "red", "purple"))) |>
ggplot() +
aes(laser_color, altitude, color = laser_color, group = laser_color) +
geom_jitter(width = .3, alpha = .75) +
scale_color_manual(values = cbPalette[1:6])+
scale_y_continuous(labels = label_comma()) +
labs(title = "Injuries by Altitude and Laser Color",
subtitle = "2010 - 2021",
caption = "Federal Aviation Admin.")
source("https://raw.githubusercontent.com/iascchen/VisHealth/master/R/calendarHeat.R")
a <-
lasers |>
filter(date_time > "2017-01-01") |>
mutate(day = floor_date(date_time, "day")) |>
group_by(day) |>
summarise(incidents_per_day = n()) |>
mutate(year = floor_date(day, "year")) |>
group_by(year) |>
mutate(avg_incidents_per_day  = mean(incidents_per_day)) |>
mutate(z_score = (incidents_per_day - avg_incidents_per_day)/
avg_incidents_per_day)
r2b <- c("#611300", "#CC4E25", "#EBB0A8", "#F9F9F9", "#B3D0E4", "#008BBD",
"#003560")
calendarHeat(a$day, a$z_score, ncolors = 99, color = "r2b", varname="Aircraft Laser Incidents")
library(forecast)
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n()) |>
filter(month >= "2017-01-01")
lasers_ts <-
ts(lasers_mon$incidents_per_month,
start = 2017,
frequency = 12
)
lasers_ts |>
ggseasonplot(
year.labels = TRUE,
year.labels.left = TRUE) +
labs(title = "Seasonal Plot Laser Incidents",
subtitle = "2017 - 2021",
caption = "Federal Aviation Admin.") +
#scale_color_manual(values = colorspace::qualitative_hcl(n = 5))+
scale_color_manual(values = cbPalette[1:5]) +
ggthemes::theme_fivethirtyeight()
lasers_day <-
lasers |>
filter(date_time >= "2017-01-01") |>
mutate(hour = hour(date_time)) |>
mutate(year = year(date_time)) |>
mutate(year = factor(year)) |>
group_by(year, hour) |>
summarise(incidents_per_hour = n())
lasers_day |>
ggplot() +
aes(hour, incidents_per_hour, group = year, color = year) +
geom_line() +
geom_point() +
scale_color_manual(values = cbPalette[1:5]) +
scale_y_continuous(name = "", labels = scales::label_comma()) +
scale_x_continuous(
breaks = seq(0, 23, by = 6),
labels = paste0(seq(0, 23 , by = 6), ":00")
) +
labs(title = "Laser Incidents by Hour",
subtitle = "2017-2021",
caption = "Federal Aviation Admin.")+
ggthemes::theme_fivethirtyeight()
library(tsibble)
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n())
lasers_mon |>
mutate(month = yearmonth(month)) |>
as_tsibble(index = month) |>
stl(t.window = 13, s.window = "periodic", robust = TRUE) |>
forecast::autoplot() +
labs(title = "Decomposition of Laser Incidents",
subtitle = "2010 - 2021",
caption = "Federal Aviation Admin.") +
ggthemes::theme_fivethirtyeight()
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n()) |>
filter(month >= "2010-01-01") |>
mutate(month = yearmonth(month)) |>
as_tsibble(index = month)
laser_fc <-
lasers_mon |>
model(ETS(incidents_per_month)) |>
forecast(h = 12)
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .),
shadecols = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
library(tibble)
library(tsibble)
library(tsibbledata)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(feasts)
library(fable)
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n()) |>
filter(month >= "2010-01-01") |>
mutate(month = yearmonth(month)) |>
as_tsibble(index = month)
laser_fc <-
lasers_mon |>
model(ETS(incidents_per_month)) |>
forecast(h = 12)
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .),
shadecols = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
library(tibble)
library(tsibble)
library(tsibbledata)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(feasts)
library(fable)
library(lasers)
data(lasers)
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n()) |>
filter(month >= "2010-01-01") |>
mutate(month = yearmonth(month)) |>
as_tsibble(index = month)
#lag plot
lasers_mon |>
gg_lag(incidents_per_month, geom = "point", lags = 1:6) +
labs("lag(lasers, k")
#train
train <-
lasers_mon |>
filter_index(~ "2021-01")
train |> str()
# Fit the models
lasers_fit <- train %>%
model(
Mean = MEAN(incidents_per_month),
`Naive` = NAIVE(incidents_per_month),
`Seasonal naïve` = SNAIVE(incidents_per_month),
`ETS` = ETS(incidents_per_month),
`ARIMA` = ARIMA(incidents_per_month)
)
lasers_fc <- lasers_fit |> forecast(h = 12)
library(tibble)
library(tsibble)
library(tsibbledata)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(feasts)
library(fable)
library(lasers)
data(lasers)
lasers_mon <-
lasers |>
mutate(month = floor_date(date_time, "month")) |>
group_by(month) |>
summarise(incidents_per_month = n()) |>
filter(month >= "2010-01-01") |>
mutate(month = yearmonth(month)) |>
as_tsibble(index = month)
#lag plot
lasers_mon |>
gg_lag(incidents_per_month, geom = "point", lags = 1:6) +
labs("lag(lasers, k")
#train
train <-
lasers_mon |>
filter_index(~ "2021-01")
train |> str()
# Fit the models
lasers_fit <- train %>%
model(
Mean = MEAN(incidents_per_month),
`Naive` = NAIVE(incidents_per_month),
`Seasonal naïve` = SNAIVE(incidents_per_month),
`ETS` = ETS(incidents_per_month),
`ARIMA` = ARIMA(incidents_per_month)
)
lasers_fc <- lasers_fit |> forecast(h = 12)
lasers_fc |>
autoplot(train, level = NULL) +
autolayer(
filter_index(lasers_mon, "2021-01" ~ .),
color = "black") +
labs(
y = "incidents",
title = "Forecasts for monthly laser incidents"
) +
guides(colour = guide_legend(title = "Forecast"))
fit_naive <- train |> model(NAIVE(incidents_per_month))
fit_mean <- train |> model(MEAN(incidents_per_month))#Comparing ARIMA() and ETS() on seasonal data
fit_s_naive <- train |> model(SNAIVE(incidents_per_month))
fit_ets = train |> model(ETS(incidents_per_month))
fit_arima <- train |> model(ARIMA(incidents_per_month))
# results
bind_rows(
fit_naive |> accuracy(),
fit_mean |> accuracy(),
fit_s_naive |> accuracy(),
fit_ets |>  accuracy(),
fit_arima |> accuracy(),
fit_naive |> forecast(h = 6) |> accuracy(lasers_mon),
fit_mean |> forecast(h = 6) |> accuracy(lasers_mon),
fit_s_naive |> forecast(h = 6) |> accuracy(lasers_mon),
fit_ets |> forecast(h = 6) |> accuracy(lasers_mon),
fit_arima |> forecast(h = 6) |> accuracy(lasers_mon)
) |>
select(-ME, -MPE, -ACF1) |>
arrange(.type, MAE)
laser_fc <-
lasers_mon |>
model(ETS(incidents_per_month)) |>
forecast(h = 12)
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .),
shadecols = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#000000")
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .),
shadecols = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
?autoplot
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .)) +
scale_color_manual(values = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .)) +
scale_fill_manual(values = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "")
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .)) +
scale_fill_manual(values = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "Forecast U.S. Laser Incidents",
subtitle = "ETS model",
caption = "") +
theme(legend.position = "none")
p <-
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .)) +
scale_fill_manual(values = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "2022 Forecast for U.S. Laser Incidents",
subtitle = "ETS model",
caption = "") +
theme(legend.position = "none")
p
??ggsave
ggplot2::ggsave(p, filename = filename, height = 4, width = 6, unit = "in")
filename <- "./content/post/2022-07-27-laser-incidents-on-u-s-airplanes/forecast.png"
ggplot2::ggsave(p, filename = filename, height = 4, width = 6, unit = "in")
?ggsave
laser_fc |>
autoplot(
filter_index(lasers_mon, "2017-01" ~ .)) +
scale_fill_manual(values = cbPalette[1:2])+
ggthemes::theme_fivethirtyeight() +
scale_y_continuous(labels = scales::label_comma()) +
labs(title = "2022 Forecast for U.S. Laser Incidents",
subtitle = "ETS model",
caption = "") +
theme(legend.position = "none")
filename <- "./content/post/2022-07-27-laser-incidents-on-u-s-airplanes/forecast.png"
ggplot2::ggsave(p, filename = filename, height = 4, width = 6, unit = "in")
serve_site()
blogdown::serve_site()
knitr::include_graphics("./forecast.png")
